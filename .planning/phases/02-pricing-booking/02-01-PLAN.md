---
phase: 02-pricing-booking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - JunkOS-Clean/JunkOS/Models/BookingModels.swift
  - JunkOS-Clean/JunkOS/Views/BookingWizardView.swift
  - JunkOS-Clean/JunkOS/ViewModels/BookingWizardViewModel.swift
  - JunkOS-Clean/JunkOS/Views/HomeView.swift
autonomous: true

must_haves:
  truths:
    - "BookingData model supports Junk Removal and Auto Transport as service types"
    - "BookingData model has volume tier (1/4, 1/2, 3/4, full) for Junk Removal"
    - "BookingData model has vehicle info (non-running, enclosed) for Auto Transport"
    - "BookingData model stores pickup and dropoff coordinates for distance calculation"
    - "Booking wizard shows step progress indicator with tappable dots for completed steps"
    - "HomeView launches into the booking wizard"
  artifacts:
    - path: "JunkOS-Clean/JunkOS/Models/BookingModels.swift"
      provides: "Refactored data models for Junk Removal and Auto Transport"
      contains: "enum ServiceType"
    - path: "JunkOS-Clean/JunkOS/Views/BookingWizardView.swift"
      provides: "Multi-step wizard container with progress indicator"
      contains: "BookingWizardView"
    - path: "JunkOS-Clean/JunkOS/ViewModels/BookingWizardViewModel.swift"
      provides: "Wizard navigation state and step management"
      contains: "BookingWizardViewModel"
  key_links:
    - from: "JunkOS-Clean/JunkOS/Views/HomeView.swift"
      to: "JunkOS-Clean/JunkOS/Views/BookingWizardView.swift"
      via: "NavigationLink"
      pattern: "BookingWizardView"
    - from: "JunkOS-Clean/JunkOS/Views/BookingWizardView.swift"
      to: "JunkOS-Clean/JunkOS/ViewModels/BookingWizardViewModel.swift"
      via: "@StateObject"
      pattern: "BookingWizardViewModel"
---

<objective>
Refactor the BookingData model for Junk Removal vs Auto Transport services and create the booking wizard container with step-based navigation and tappable progress indicator.

Purpose: This is the foundation for the entire Phase 2 booking flow. The data model must support both service types with their unique fields, and the wizard container provides the navigation structure all step views will live inside.
Output: Refactored BookingModels.swift, new BookingWizardView.swift with progress dots, new BookingWizardViewModel.swift, updated HomeView.swift entry point.
</objective>

<execution_context>
@/Users/sevs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sevs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-pricing-booking/02-CONTEXT.md
@.planning/phases/02-pricing-booking/02-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-01-SUMMARY.md
@JunkOS-Clean/JunkOS/Models/BookingModels.swift
@JunkOS-Clean/JunkOS/Views/HomeView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor BookingModels.swift for Junk Removal and Auto Transport</name>
  <files>JunkOS-Clean/JunkOS/Models/BookingModels.swift</files>
  <action>
Completely rewrite BookingModels.swift to support the Phase 2 service model. This is a breaking change from the old "LoadUp" model — the old ServiceTier, CleanoutType, RoomOption, ItemOption, WeightCategory, RecurringFrequency enums are all replaced.

**New enums to add:**

1. `ServiceType: String, CaseIterable` — two cases: `junkRemoval = "Junk Removal"`, `autoTransport = "Auto Transport"`. Add computed properties:
   - `description: String` — brief description for the card ("Furniture, appliances, yard waste — we haul it all" and "Vehicle pickup and delivery anywhere")
   - `icon: String` — SF Symbol names: `"truck.box.fill"` for junk removal, `"car.fill"` for auto transport

2. `VolumeTier: String, CaseIterable` — four cases: `quarter = "1/4 Truck"`, `half = "1/2 Truck"`, `threeQuarter = "3/4 Truck"`, `full = "Full Truck"`. Add computed properties:
   - `fillLevel: Double` — returns 0.25, 0.5, 0.75, 1.0
   - `description: String` — e.g., "A few items", "Small room", "Large room", "Whole house"
   - `icon: String` — SF Symbol representing fill level (use truck symbol variants or box symbols)

**Refactor BookingData class:**

Keep existing pattern (ObservableObject with @Published). Replace old properties with:
- `serviceType: ServiceType?` (nil until user selects — drives conditional UI)
- `volumeTier: VolumeTier = .half` (default for Junk Removal)
- `vehicleMake: String = ""` (for Auto Transport)
- `vehicleModel: String = ""` (for Auto Transport)
- `vehicleYear: String = ""` (for Auto Transport)
- `isVehicleRunning: Bool = true` (for Auto Transport)
- `needsEnclosedTrailer: Bool = false` (for Auto Transport)
- `pickupCoordinate: CLLocationCoordinate2D?` (for distance calculation)
- `dropoffCoordinate: CLLocationCoordinate2D?` (Auto Transport only)
- `dropoffAddress: Address = Address()` (Auto Transport only)
- `estimatedDistance: Double?` (miles, calculated from coordinates)
- `estimatedPrice: Double?` (from backend pricing API)
- `priceBreakdown: PricingEstimate?` (detailed breakdown from backend)

Keep these existing properties as-is:
- `address` (rename conceptually to "pickup address" — same field)
- `photos: [Data]`
- `selectedDate: Date?`
- `selectedTimeSlot: String?`
- `serviceDetails: String`
- `bookingCompleted: Bool`

Remove ALL old LoadUp properties: `serviceTier`, `dontNeedToBeHome`, `outdoorPlacementInstructions`, `loaderNotes`, `isCommercialBooking`, `businessName`, `isRecurringPickup`, `recurringFrequency`, `isPropertyCleanout`, `selectedRooms`, `cleanoutType`, `selectedItems`, `beforePhotos`, `estimatedWeight`, `selectedServices`, `referralCode`, `customerName`, `customerEmail`, `customerPhone`.

Note: `selectedServices: Set<String>` is removed because the new model uses `serviceType: ServiceType?` (single selection, not multi-select).

**Add new struct `PricingEstimate`:**
```swift
struct PricingEstimate: Codable {
    let subtotal: Double
    let serviceFee: Double
    let volumeDiscount: Double
    let timeSurge: Double
    let zoneSurge: Double
    let total: Double
    let estimatedDurationMinutes: Int
    let recommendedTruck: String
}
```

**Update computed properties:**
- `isAddressValid` — keep existing logic
- `hasPhotos` — keep existing
- `hasSelectedDateTime` — keep existing
- Remove `hasSelectedServices` (replaced by checking `serviceType != nil`)
- Add `isServiceConfigured: Bool` — returns true when serviceType is set AND (if junkRemoval: volumeTier is set) OR (if autoTransport: vehicleMake, vehicleModel, vehicleYear are non-empty)
- Add `needsDropoff: Bool` — returns `serviceType == .autoTransport`

**Update `reset()` method** to clear all new fields.

Remove old enums/structs: `ServiceTier`, `Service`, `PriceBreakdown`, `RecurringFrequency`, `CleanoutType`, `RoomOption`, `ItemOption`, `WeightCategory`.

Keep: `Address`, `TimeSlot` structs.

Add `import CoreLocation` at top for `CLLocationCoordinate2D`.
  </action>
  <verify>
Build the project with `xcodebuild build -project JunkOS-Clean/JunkOS.xcodeproj -scheme JunkOS -destination 'platform=iOS Simulator,name=iPhone 16'`. Fix any compilation errors caused by removing old model types — other views (ServiceSelectionView, ConfirmationView, etc.) will have errors, but those views will be rewritten in later plans. For now, add `// TODO: Phase 2 refactor` stub comments to make them compile, or add minimal stub types if the build errors cascade badly. The goal is a compiling project with the new data model.
  </verify>
  <done>
BookingModels.swift contains ServiceType enum (junkRemoval, autoTransport), VolumeTier enum (quarter, half, threeQuarter, full), refactored BookingData with new properties (serviceType, volumeTier, vehicle fields, coordinates, pricing), PricingEstimate struct. Old LoadUp types removed. Project compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BookingWizardView with progress indicator and HomeView entry point</name>
  <files>JunkOS-Clean/JunkOS/Views/BookingWizardView.swift, JunkOS-Clean/JunkOS/ViewModels/BookingWizardViewModel.swift, JunkOS-Clean/JunkOS/Views/HomeView.swift</files>
  <action>
**Create BookingWizardViewModel.swift:**

ObservableObject managing wizard state:
- `@Published var currentStep: Int = 0` — index of current step
- `@Published var completedSteps: Set<Int> = []` — tracks which steps the user has completed (for tappable dots)
- `let stepCount: Int = 5` — total steps in wizard

**Step order (Claude's discretion, optimized for data dependencies):**
0. Service Selection (needed first — determines if we show truck fill or vehicle info, and if we need dropoff address)
1. Address Entry (needed for pricing — provides coordinates for distance calc)
2. Photos (optional but best before scheduling so user sees what they're booking)
3. Schedule (date/time selection)
4. Review & Confirm (final summary)

Methods:
- `func goToStep(_ step: Int)` — only allows jumping to completed steps or current step. Sets `currentStep`.
- `func completeCurrentStep()` — adds `currentStep` to `completedSteps`, increments `currentStep`.
- `func goBack()` — decrements `currentStep` (minimum 0).
- `var canGoBack: Bool` — currentStep > 0
- `var isLastStep: Bool` — currentStep == stepCount - 1
- `func stepTitle(for index: Int) -> String` — returns step name ("Service", "Address", "Photos", "Schedule", "Review")
- `func isStepAccessible(_ step: Int) -> Bool` — step <= currentStep or step is in completedSteps

**Create BookingWizardView.swift:**

The main container view for the entire booking flow. Uses `@StateObject var bookingData = BookingData()` and `@StateObject var wizardVM = BookingWizardViewModel()`.

Layout:
1. Top: Progress indicator bar with 5 tappable dots
   - Each dot is a circle (12pt diameter)
   - Completed steps: filled red circle (Color.umuvePrimary) — tappable, jumps to that step
   - Current step: filled red circle with ring outline
   - Future steps: gray outline circle — not tappable
   - Step labels below dots ("Service", "Address", "Photos", "Schedule", "Review") in UmuveTypography.smallFont
   - Horizontal line connecting dots (gray, turns red for completed steps)

2. Middle: Content area that switches based on `wizardVM.currentStep`:
   - 0: ServiceTypeSelectionView (will be created in Plan 02)
   - 1: AddressInputView (will be refactored in Plan 03)
   - 2: PhotoUploadView (will be cleaned up in Plan 04)
   - 3: DateTimePickerView (will be cleaned up in Plan 04)
   - 4: BookingReviewView (will be created in Plan 05)

   For now, since those views aren't refactored yet, use placeholder Text views: `Text("Step \(wizardVM.currentStep + 1): \(wizardVM.stepTitle(for: wizardVM.currentStep))")` for each step. The actual views will be wired in later plans.

3. Bottom: Running price estimate bar (sticky at bottom)
   - Shows "Estimated: $XXX" when `bookingData.estimatedPrice` is not nil
   - Hidden when price is nil (first step before any data)
   - Expandable: tap to show line-item breakdown (if `bookingData.priceBreakdown` exists)
   - Use `Color.umuveWhite` background with top shadow

Pass `bookingData` as `.environmentObject()` to all child views. Pass `wizardVM` as `.environmentObject()` too so child views can call `completeCurrentStep()`.

Use existing design system: `Color.umuveBackground`, `UmuveTypography`, `UmuveSpacing`.

**Update HomeView.swift:**

Replace the current `serviceCategoriesSection` with two service type cards per the user's locked decision:
- "Junk Removal" card with `truck.box.fill` icon
- "Auto Transport" card with `car.fill` icon

Each card is a full-width tappable card. On tap, navigate to `BookingWizardView()` and pre-set `bookingData.serviceType` to the tapped service type.

Remove `ServiceCategory` model and `ServiceCategoryCard` — replaced by the two direct cards.

Keep: headerSection, searchBar (can stay), trustBadgesSection, howItWorksSection.

Add new files to Xcode project using the Python script approach from Phase 1 (insert PBXFileReference and PBXBuildFile entries into project.pbxproj). New files: BookingWizardView.swift and BookingWizardViewModel.swift.
  </action>
  <verify>
Build the project with `xcodebuild build -project JunkOS-Clean/JunkOS.xcodeproj -scheme JunkOS -destination 'platform=iOS Simulator,name=iPhone 16'`. Verify:
1. HomeView shows two service type cards
2. BookingWizardView exists and has 5-step progress indicator
3. Tapping a service card navigates to BookingWizardView
4. Project compiles without errors
  </verify>
  <done>
BookingWizardView.swift has a 5-step wizard container with tappable progress dots, step content switching, and running price estimate bar. BookingWizardViewModel.swift manages step navigation state. HomeView.swift shows two full-width service type cards (Junk Removal, Auto Transport) that navigate to the wizard. Both new files are added to Xcode project. Project compiles.
  </done>
</task>

</tasks>

<verification>
- BookingModels.swift has ServiceType enum with junkRemoval and autoTransport
- BookingModels.swift has VolumeTier enum with quarter, half, threeQuarter, full
- BookingData has serviceType, volumeTier, vehicle info fields, coordinate fields, pricing fields
- BookingWizardView has 5-step progress indicator with tappable dots
- HomeView shows two service cards and navigates to wizard
- Project compiles: `xcodebuild build` succeeds
</verification>

<success_criteria>
The data model foundation and wizard navigation container are in place. Other plans can now implement individual step views against this model and plug them into the wizard.
</success_criteria>

<output>
After completion, create `.planning/phases/02-pricing-booking/02-01-SUMMARY.md`
</output>
