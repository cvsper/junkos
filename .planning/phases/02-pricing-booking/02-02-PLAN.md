---
phase: 02-pricing-booking
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - JunkOS-Clean/JunkOS/Views/ServiceTypeSelectionView.swift
  - JunkOS-Clean/JunkOS/ViewModels/ServiceSelectionViewModel.swift
  - JunkOS-Clean/JunkOS/Views/BookingWizardView.swift
autonomous: true

must_haves:
  truths:
    - "Customer sees two large full-width tappable cards: Junk Removal and Auto Transport"
    - "Selecting Junk Removal shows visual truck fill selector with 1/4, 1/2, 3/4, full levels"
    - "Selecting Auto Transport shows vehicle info fields and surcharge toggles"
    - "Running price estimate updates when service type or options change"
    - "Service selection step plugs into BookingWizardView as step 0"
  artifacts:
    - path: "JunkOS-Clean/JunkOS/Views/ServiceTypeSelectionView.swift"
      provides: "Service type selection with conditional detail views"
      contains: "ServiceTypeSelectionView"
    - path: "JunkOS-Clean/JunkOS/ViewModels/ServiceSelectionViewModel.swift"
      provides: "Service selection logic and pricing trigger"
      contains: "ServiceSelectionViewModel"
  key_links:
    - from: "JunkOS-Clean/JunkOS/Views/BookingWizardView.swift"
      to: "JunkOS-Clean/JunkOS/Views/ServiceTypeSelectionView.swift"
      via: "step 0 in wizard switch"
      pattern: "ServiceTypeSelectionView"
    - from: "JunkOS-Clean/JunkOS/Views/ServiceTypeSelectionView.swift"
      to: "JunkOS-Clean/JunkOS/Models/BookingModels.swift"
      via: "@EnvironmentObject bookingData"
      pattern: "bookingData.serviceType"
---

<objective>
Build the service type selection screen (Step 1 of wizard) with two large cards for Junk Removal and Auto Transport, visual truck fill selector for junk removal volume, and vehicle info fields with surcharge toggles for auto transport.

Purpose: This is the first user interaction in the booking flow. The service type choice determines what data the rest of the wizard collects (volume vs vehicle, single address vs two addresses). The running price estimate begins updating here.
Output: New ServiceTypeSelectionView.swift, refactored ServiceSelectionViewModel.swift, updated BookingWizardView.swift wiring.
</objective>

<execution_context>
@/Users/sevs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sevs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-pricing-booking/02-CONTEXT.md
@.planning/phases/02-pricing-booking/02-RESEARCH.md
@.planning/phases/02-pricing-booking/02-01-SUMMARY.md
@JunkOS-Clean/JunkOS/Models/BookingModels.swift
@JunkOS-Clean/JunkOS/Views/BookingWizardView.swift
@JunkOS-Clean/JunkOS/ViewModels/BookingWizardViewModel.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ServiceTypeSelectionView with cards, truck fill selector, and vehicle info</name>
  <files>JunkOS-Clean/JunkOS/Views/ServiceTypeSelectionView.swift, JunkOS-Clean/JunkOS/ViewModels/ServiceSelectionViewModel.swift</files>
  <action>
**Create ServiceTypeSelectionView.swift** — the first step of the booking wizard.

Per user's locked decisions:
- Two large full-width tappable cards with icon, title, and brief description
- Junk Removal card and Auto Transport card — tap to select, highlighted state

Layout (ScrollView):
1. **Header**: "What do you need?" title, "Choose a service" subtitle. Use existing `ScreenHeader` component pattern but without the progress bar (wizard handles progress).

2. **Service Type Cards** (VStack, full-width):
   Each card is a Button that sets `bookingData.serviceType`:
   - Icon (SF Symbol, 40pt, in a colored circle background)
   - Title (h2Font, semibold)
   - Description (bodySmallFont, muted)
   - Selected state: red border (Color.umuvePrimary, 3pt), light red background tint, checkmark icon
   - Unselected state: gray border (Color.umuveBorder, 1pt), white background
   - Junk Removal: icon `truck.box.fill`, description from ServiceType.junkRemoval.description
   - Auto Transport: icon `car.fill`, description from ServiceType.autoTransport.description
   - Card height: ~120pt, rounded corners 16pt

3. **Conditional Detail Section** (appears below cards after selection):

   If serviceType == .junkRemoval → Show **Truck Fill Selector**:
   - Section title: "How much do you have?"
   - 4 tappable cards in a 2x2 grid (LazyVGrid, 2 columns)
   - Each card represents a VolumeTier: shows fill level illustration, tier name, description
   - Visual: Use a truck icon with varying opacity/fill to represent 1/4, 1/2, 3/4, full
     - 1/4: `truck.box` with small filled rectangle at bottom (25% height) — use a ZStack with Rectangle clipped
     - Alternative simpler approach: Use 4 horizontal bars/blocks, fill 1-4 of them with red to show level
     - Each card: icon/illustration at top, tier name ("1/4 Truck"), description ("A few items") below
   - Selected state: red border + background tint, checkmark
   - Default selection: .half (from BookingData default)

   If serviceType == .autoTransport → Show **Vehicle Info + Surcharges**:
   - Section title: "Vehicle Details"
   - TextFields: Vehicle Make (e.g., "Toyota"), Vehicle Model (e.g., "Camry"), Vehicle Year (e.g., "2020")
     - Use InputField component pattern from AddressInputView (icon + placeholder + binding)
     - Icons: `car.fill`, `car.side`, `calendar`
   - Toggle: "Vehicle is non-running" (bound to `!bookingData.isVehicleRunning` — note inversion)
     - When on: adds surcharge messaging "Non-running vehicle surcharge applies"
   - Toggle: "Needs enclosed trailer" (bound to `bookingData.needsEnclosedTrailer`)
     - When on: adds surcharge messaging "Enclosed trailer surcharge applies"
   - Surcharge toggles styled as Toggle rows with descriptive text

4. **Continue Button** (safeAreaInset bottom):
   - Text: "Continue"
   - Enabled when `bookingData.isServiceConfigured` is true
   - On tap: call `wizardVM.completeCurrentStep()` via EnvironmentObject
   - Use `UmuvePrimaryButtonStyle`

**Refactor ServiceSelectionViewModel.swift:**

Replace old content entirely. New class:
- `@Published var isLoading = false`
- `func requestPricingEstimate(for bookingData: BookingData) async` — calls backend `/api/pricing/estimate` to get initial estimate based on service type and volume. For now, implement as a stub that sets a placeholder price (actual backend integration happens in Plan 04). Set `bookingData.estimatedPrice` with the result.

Note: The old ServiceSelectionView.swift can be left in place (it will be unused once the wizard wires to ServiceTypeSelectionView). Don't delete it — Xcode project references would break.

Add ServiceTypeSelectionView.swift to Xcode project (PBXFileReference + PBXBuildFile in project.pbxproj).

Use existing design system throughout: `Color.umuveBackground`, `Color.umuvePrimary`, `Color.umuveBorder`, `Color.umuveWhite`, `UmuveTypography`, `UmuveSpacing`, `UmuveCard`.
  </action>
  <verify>
Build the project: `xcodebuild build -project JunkOS-Clean/JunkOS.xcodeproj -scheme JunkOS -destination 'platform=iOS Simulator,name=iPhone 16'`. Verify:
1. ServiceTypeSelectionView exists and compiles
2. Two service type cards render with icons and descriptions
3. Selecting Junk Removal shows truck fill selector (4 options)
4. Selecting Auto Transport shows vehicle info fields and surcharge toggles
5. Continue button is disabled until service is configured
  </verify>
  <done>
ServiceTypeSelectionView shows two full-width service cards (Junk Removal, Auto Transport). Junk Removal reveals truck fill selector with 4 volume tiers. Auto Transport reveals vehicle info fields + surcharge toggles. Continue button enables when service is fully configured. Project compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire ServiceTypeSelectionView into BookingWizardView as Step 0</name>
  <files>JunkOS-Clean/JunkOS/Views/BookingWizardView.swift</files>
  <action>
Update BookingWizardView.swift to replace the placeholder Text view for step 0 with `ServiceTypeSelectionView()`.

In the step content switch/conditional:
- Case 0: `ServiceTypeSelectionView().environmentObject(bookingData).environmentObject(wizardVM)`
- Cases 1-4: keep placeholder Text views for now (they'll be wired in Plans 03, 04, 05)

Ensure that when the user taps "Continue" on ServiceTypeSelectionView, the wizard advances to step 1 (Address). The `completeCurrentStep()` call from the ServiceTypeSelectionView's Continue button should handle this.

Also verify: If the user navigates from HomeView with a pre-selected serviceType (tapping Junk Removal or Auto Transport card on HomeView), the ServiceTypeSelectionView should show that service as already selected and display the appropriate detail section immediately.
  </action>
  <verify>
Build the project. Verify the wizard shows ServiceTypeSelectionView on step 0 and placeholder views for steps 1-4. Tapping Continue on step 0 should advance to step 1.
  </verify>
  <done>
BookingWizardView shows ServiceTypeSelectionView as step 0. Continue advances to step 1. Pre-selected serviceType from HomeView is reflected in the selection. Project compiles.
  </done>
</task>

</tasks>

<verification>
- ServiceTypeSelectionView has two full-width cards (Junk Removal, Auto Transport)
- Junk Removal card selection reveals truck fill selector (1/4, 1/2, 3/4, full)
- Auto Transport card selection reveals vehicle info fields + surcharge toggles
- ServiceTypeSelectionView is wired as step 0 in BookingWizardView
- Continue button calls wizardVM.completeCurrentStep() to advance wizard
- Project compiles: `xcodebuild build` succeeds
</verification>

<success_criteria>
Customer can select between Junk Removal and Auto Transport, configure service-specific options (volume tier or vehicle info), and advance to the next wizard step.
</success_criteria>

<output>
After completion, create `.planning/phases/02-pricing-booking/02-02-SUMMARY.md`
</output>
